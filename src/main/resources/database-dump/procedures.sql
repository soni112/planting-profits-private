/*
SQLyog Ultimate v11.5 (64 bit)
MySQL - 5.7.16-0ubuntu0.16.04.1 : Database - agriculture_planning
*********************************************************************
*/


/*!40101 SET NAMES utf8 */;

/*!40101 SET SQL_MODE=''*/;

/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
CREATE DATABASE /*!32312 IF NOT EXISTS*/`agriculture_planning` /*!40100 DEFAULT CHARACTER SET latin1 */;

USE `agriculture_planning`;

/* Procedure structure for procedure `removeFirmAllRecord` */

/*!50003 DROP PROCEDURE IF EXISTS  `removeFirmAllRecord` */;

DELIMITER $$

/*!50003 CREATE PROCEDURE `removeFirmAllRecord`(IN farmId INT)
BEGIN
  SET FOREIGN_KEY_CHECKS = 0;
  SET @CROP_TYPE_ID = 0;
  SET @SQL = CONCAT('DELETE FROM FARM_OUTPUT_DETAILS WHERE FARM_INFO_ID IN (', farmId, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM FARM_OUTPUT_DETAILS_FOR_FIELD WHERE FARM_INFO_ID IN (', farmId, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET FOREIGN_KEY_CHECKS = 1;
 END */$$
DELIMITER ;

/* Procedure structure for procedure `removeFirmAllRecordOld` */

/*!50003 DROP PROCEDURE IF EXISTS  `removeFirmAllRecordOld` */;

DELIMITER $$

/*!50003 CREATE PROCEDURE `removeFirmAllRecordOld`(IN farmId INT)
BEGIN
  SET FOREIGN_KEY_CHECKS = 0;
  SET @CROP_TYPE_ID = 0;
  SET @SQL = CONCAT('SELECT GROUP_CONCAT(CROP_TYPE_ID) INTO @CROP_TYPE_ID FROM CROP_TYPE WHERE
                    FARM_INFO_ID IN (', farmId, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  /** select @CROP_TYPE_ID;	*/
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM CROP_FIELD_CHOICES WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM CROP_FORWARD_SALES WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM CROP_LIMIT WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  /** Code To Fetch ResourseIds From CROP_RESOURCE_USAGE Table According To FarmId    */
  SET @RESOURSE_IDS = 0;
  SET @SQL = CONCAT('SELECT group_concat(CROP_RESOURCE_USAGE_ID) INTO @RESOURSE_IDS FROM CROP_RESOURCE_USAGE WHERE
                    FARM_INFO_ID IN (', farmId, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  SELECT @RESOURSE_IDS;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM CROP_RES_USAGE_FIELD_DIFF WHERE CROP_RESOURCE_USAGE_ID IN (', @RESOURSE_IDS, ')
                    ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM CROP_RES_USAGE_FIELD_VARI WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM CROP_RESOURCE_USAGE WHERE FARM_INFO_ID IN (', farmId, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM CROP_UNIT_OF_MEASURE WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM CROP_YIELD_FIELD_VARIANCES WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM INT_VAR_CROP_PRO_COSTS WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM INTERNAL_CROP_PRICES_INFO WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM INTERNAL_CROP_YIELD_INFO WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM OPT_CROP_PLANT_DAT WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM OPT_CROP_PRO_COST_DET WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM SUMMARY_CROP_INFO WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM FARM_OUTPUT_DETAILS WHERE FARM_INFO_ID IN (', farmId, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM FARM_OUTPUT_DETAILS_FOR_FIELD WHERE FARM_INFO_ID IN (', farmId, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM GROUP_CROPS WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM CROP_TYPE WHERE FARM_INFO_ID IN (', farmId, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM CROPS_GROUP WHERE FARM_INFO_ID IN (', farmId, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET @SQL = CONCAT('DELETE FROM FIELD_INFO WHERE FARM_INFO_ID IN (', farmId, ') ');
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET FOREIGN_KEY_CHECKS = 1;
 END */$$
DELIMITER ;

/* Procedure structure for procedure `removeSelectedFarmsAndAllRecord` */

/*!50003 DROP PROCEDURE IF EXISTS  `removeSelectedFarmsAndAllRecord` */;

DELIMITER $$

/*!50003 CREATE PROCEDURE `removeSelectedFarmsAndAllRecord`(`farmId` VARCHAR(1000))
BEGIN
   # Deletion of strategies
    SELECT 0;
      SET FOREIGN_KEY_CHECKS = 0;
      SET @STRATEGY_IDS = 0;
      SET @SQL = CONCAT('SELECT group_concat(DISTINCT FARM_CUSTOM_STRATEGY_ID) INTO @STRATEGY_IDS FROM FARM_CUSTOM_STRATEGY WHERE FARM_ID IN (', farmId, ') ');
      PREPARE stmt FROM @SQL;
      EXECUTE stmt;
      SELECT @STRATEGY_IDS;
      select 1;
      DEALLOCATE PREPARE stmt;
      select @STRATEGY_IDS;
      if @STRATEGY_IDS IS NOT NULL THEN
	SET @SQL = CONCAT('DELETE FROM FARM_CUSTOM_STRATEGY_FOR_CROP WHERE FARM_CUSTOM_STRATEGY_ID IN (', @STRATEGY_IDS, ') ');
	PREPARE stmt FROM @SQL;
	EXECUTE stmt;
	SELECT 2;
	DEALLOCATE PREPARE stmt;
	SET @SQL = CONCAT('DELETE FROM FARM_CUSTOM_STRATEGY_FOR_GROUP WHERE FARM_CUSTOM_STRATEGY_ID IN (', @STRATEGY_IDS, ') ');
	PREPARE stmt FROM @SQL;
	EXECUTE stmt;
	SELECT 3;
	DEALLOCATE PREPARE stmt;
	SET @SQL = CONCAT('DELETE FROM FARM_CUSTOM_STRATEGY_FOR_RESOURSE WHERE FARM_CUSTOM_STRATEGY_ID IN (', @STRATEGY_IDS, ') ');
	PREPARE stmt FROM @SQL;
	EXECUTE stmt;
	SELECT 4;
	DEALLOCATE PREPARE stmt;
	SET @SQL = CONCAT('DELETE FROM FARM_CUSTOM_STRATEGY WHERE FARM_CUSTOM_STRATEGY_ID IN (', @STRATEGY_IDS, ') ');
	PREPARE stmt FROM @SQL;
	EXECUTE stmt;
	SELECT 5;
	DEALLOCATE PREPARE stmt;
	# Deletion of scenarios
	SET @SCENARIO_IDS = 0;
	SET @SQL = CONCAT('SELECT group_concat(DISTINCT SCENARIO_ID) INTO @SCENARIO_IDS FROM FARM_STRATEGY_SCENARIO WHERE FARM_CUSTOM_STRATEGY_ID IN (', @STRATEGY_IDS, ') ');
	PREPARE stmt FROM @SQL;
	EXECUTE stmt;
	SELECT 6;
	select @SCENARIO_IDS;
	DEALLOCATE PREPARE stmt;
	IF @SCENARIO_IDS IS NOT NULL THEN
	SET @SQL = CONCAT('DELETE FROM FARM_STRATEGY_SCENARIO_CROP_SPECIFIC WHERE SCENARIO_ID IN (', @SCENARIO_IDS, ') ');
	PREPARE stmt FROM @SQL;
	EXECUTE stmt;
	SELECT 7;
	DEALLOCATE PREPARE stmt;
	SET @SQL = CONCAT('DELETE FROM FARM_STRATEGY_SCENARIO WHERE SCENARIO_ID IN (', @SCENARIO_IDS, ') ');
	PREPARE stmt FROM @SQL;
	EXECUTE stmt;
	SELECT 8;
	DEALLOCATE PREPARE stmt;
	END IF;
      end if;

    SET @FARM_INFO_ID = 0;
    SET @SQL = CONCAT('SELECT GROUP_CONCAT(DISTINCT FARM_INFO_ID) INTO @FARM_INFO_ID FROM FARM_INFO WHERE FARM_ID IN (', farmId, ') ');
    PREPARE stmt FROM @SQL;
    EXECUTE stmt;
    SELECT 9;
    # deletion of farm info details
    IF @FARM_INFO_ID IS NOT NULL THEN

	    SET @CROP_TYPE_ID = 0;
	    SET @SQL = CONCAT('SELECT GROUP_CONCAT(DISTINCT CROP_TYPE_ID) INTO @CROP_TYPE_ID FROM CROP_TYPE WHERE FARM_INFO_ID IN (', @FARM_INFO_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 10;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM CROP_FIELD_CHOICES WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 11;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM CROP_FORWARD_SALES WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 12;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM CROP_LIMIT WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 13;
	    DEALLOCATE PREPARE stmt;
	    SET @RESOURSE_IDS = 0;
	    SET @SQL = CONCAT('SELECT group_concat(DISTINCT CROP_RESOURCE_USAGE_ID) INTO @RESOURSE_IDS FROM CROP_RESOURCE_USAGE WHERE FARM_INFO_ID IN (', @FARM_INFO_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 14;
	    SELECT @RESOURSE_IDS;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM CROP_RES_USAGE_FIELD_DIFF WHERE CROP_RESOURCE_USAGE_ID IN (', @RESOURSE_IDS, ')');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 15;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM CROP_RES_USAGE_FIELD_VARI WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 16;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM CROP_RESOURCE_USAGE WHERE FARM_INFO_ID IN (', @FARM_INFO_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 17;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM CROP_UNIT_OF_MEASURE WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 18;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM CROP_YIELD_FIELD_VARIANCES WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 19;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM INT_VAR_CROP_PRO_COSTS WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 20;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM INTERNAL_CROP_PRICES_INFO WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 21;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM INTERNAL_CROP_YIELD_INFO WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 22;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM OPT_CROP_PLANT_DAT WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 23;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM OPT_CROP_PRO_COST_DET WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 24;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM SUMMARY_CROP_INFO WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 25;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM FARM_OUTPUT_DETAILS WHERE FARM_INFO_ID IN (', @FARM_INFO_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 26;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM FARM_OUTPUT_DETAILS_FOR_FIELD WHERE FARM_INFO_ID IN (', @FARM_INFO_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 27;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM GROUP_CROPS WHERE CROP_TYPE_ID IN (', @CROP_TYPE_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 28;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM CROP_TYPE WHERE FARM_INFO_ID IN (', @FARM_INFO_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 29;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM CROPS_GROUP WHERE FARM_INFO_ID IN (', @FARM_INFO_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 30;
	    DEALLOCATE PREPARE stmt;
	    SET @SQL = CONCAT('DELETE FROM FIELD_INFO WHERE FARM_INFO_ID IN (', @FARM_INFO_ID, ') ');
	    PREPARE stmt FROM @SQL;
	    EXECUTE stmt;
	    SELECT 31;
	    DEALLOCATE PREPARE stmt;

    end if;
    # deletin of farm and farm info
    SET @SQL = CONCAT('DELETE FROM FARM_INFO WHERE FARM_ID IN (', farmId, ') ');
    PREPARE stmt FROM @SQL;
    EXECUTE stmt;
    SELECT 32;
    SET @SQL = CONCAT('DELETE FROM FARM WHERE FARM_ID IN (', farmId, ') ');
    PREPARE stmt FROM @SQL;
    EXECUTE stmt;
    SELECT 33;
    DEALLOCATE PREPARE stmt;

    SET FOREIGN_KEY_CHECKS = 1;
  END */$$
DELIMITER ;

/* Procedure structure for procedure `removeStrategy` */

/*!50003 DROP PROCEDURE IF EXISTS  `removeStrategy` */;

DELIMITER $$

/*!50003 CREATE PROCEDURE `removeStrategy`(IN strategyId VARCHAR(1000))
BEGIN
  SET FOREIGN_KEY_CHECKS = 0;
  # Delete from Farm_custom_strategy_for_resources
  SET @SQL = CONCAT('DELETE FROM FARM_CUSTOM_STRATEGY_FOR_RESOURSE WHERE FARM_CUSTOM_STRATEGY_ID = ', strategyId);
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  # Delete from Farm_custom_strategy_for_group'
  SET @SQL = CONCAT('DELETE FROM FARM_CUSTOM_STRATEGY_FOR_GROUP WHERE FARM_CUSTOM_STRATEGY_ID = ', strategyId);
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  # Delete from Farm_custom_strategy_for_crop
  SET @SQL = CONCAT('DELETE FROM FARM_CUSTOM_STRATEGY_FOR_CROP WHERE FARM_CUSTOM_STRATEGY_ID = ', strategyId);
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  # Delete from Farm_custom_strategy
  SET @SQL = CONCAT('DELETE FROM FARM_CUSTOM_STRATEGY WHERE FARM_CUSTOM_STRATEGY_ID = ', strategyId);
  PREPARE stmt FROM @SQL;
  EXECUTE stmt;
  DEALLOCATE PREPARE stmt;
  SET FOREIGN_KEY_CHECKS = 1;
 END */$$
DELIMITER ;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
